<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE Rule PUBLIC "sailpoint.dtd" "sailpoint.dtd">
<Rule language="beanshell" name="TestHR-Rule-Correlation" type="Correlation">
  <Description>Identity Correlation Rules are used to find identities to which new accounts can be attached.

A correlation rule must return a Map with one of the specified Return arguments.</Description>
  <Signature returnType="Map">
    <Inputs>
      <Argument name="log" type="org.apache.commons.logging.Log">
        <Description>
          The log object associated with the SailPointContext.
        </Description>
      </Argument>
      <Argument name="context" type="sailpoint.api.SailPointContext">
        <Description>
          A sailpoint.api.SailPointContext object that can be used to query the database if necessary.
        </Description>
      </Argument>
      <Argument name="environment" type="Map">
        <Description>
          Arguments passed to the aggregation task.
        </Description>
      </Argument>
      <Argument name="application">
        <Description>
          Application being aggregated.
        </Description>
      </Argument>
      <Argument name="account">
        <Description>
          A sailpoint.object.ResourceObject returned from the
          collector.
        </Description>
      </Argument>
      <Argument name="link">
        <Description>
          Existing link to this account.
        </Description>
      </Argument>
    </Inputs>
    <Returns>
      <Argument name="identityName">
        <Description>
          The name of an Identity object.
        </Description>
      </Argument>
      <Argument name="identity">
        <Description>
          A fully resolved Identity object if the rule wants
          to do its own queries to locate the identity.
        </Description>
      </Argument>
      <Argument name="identityAttributeName">
        <Description>
          The name of the extended attribute that can be used
          to locate an existing identity.
        </Description>
      </Argument>
      <Argument name="identityAttributeValue">
        <Description>
          The value of the named extended attribute that can be used
          to locate an existing identity. This attribute is used
          together with the identityAttributeName argument.
        </Description>
      </Argument>
    </Returns>
  </Signature>
  <Source>import org.apache.log4j.Logger;
import sailpoint.object.Filter;
import sailpoint.tools.Util;
import sailpoint.object.Identity;
import java.util.Map;
import java.util.HashMap;
/*
Logger log = Logger.getLogger("com.eshiam.HR-Rule");
 Map map =   new HashMap();
log.info("Entering into HR-rule Correlation");
String empId = account.getStringAttribute("EmployeeID");
String name = account.getStringAttribute("Name");

if(Util.isNotNullOrEmpty(empId) &amp;&amp; Util.isNotNullOrEmpty(name)){
Filter filter1 = Filter.eq("EmployeeID",empId);
Filter  filter2 = Filter.eq("displayName",name);
filter = Filter.ignoreCase(Filter.and(filter1,filter2));

Identity id = context.getUniqueObject(Identity.class,filter);
if(id!=null){
map.put("identity",id);
log.info("correlation done with identity = "+id);
}
}
//end
log.info("Exiting HR-rule Correlation");
return map;

*/


System.out.println("account"+account.toXml());
  System.out.println("accountget Identity"+account.getIdentity());

System.out.println("application"+application.toXml());
  if(link!=null){
System.out.println("link"+link.toXml());
System.out.println("link get Name"+link.getName());
  }

 Map map =   new HashMap();

  String name = account.getStringAttribute("Name");
if(name.contains("Allen")){
System.out.println("name in correaltion"+name);
return map;
}
  
else{
   Identity idObject = context.getObjectByName(Identity.class,"Staging Identity");
if(idObject !=null){
System.out.println("idObjname in correaltion"+idObject.getName());
   map.put("identity",idObject);
  return map;
}
}</Source>
</Rule>