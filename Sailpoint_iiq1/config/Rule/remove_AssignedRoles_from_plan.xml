<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE Rule PUBLIC "sailpoint.dtd" "sailpoint.dtd">
<Rule language="beanshell" name="remove AssignedRoles from plan" type="Validation">
  <Description>This program will return all the objects from Identity Class</Description>
  <Source>
        import sailpoint.object.Identity;
        import sailpoint.object.Link;
        import sailpoint.object.Application;
        import sailpoint.object.ProvisioningPlan;
        import sailpoint.object.ProvisioningPlan.AccountRequest;
        import sailpoint.object.ProvisioningPlan.AttributeRequest;
        import sailpoint.api.Provisioner;
        import sailpoint.object.Bundle;

        System.out.println("inside Remove Assigned Roles:");
       // String identityName="Crystal Schmidt";
        Identity identity = context.getObjectByName(Identity.class,identityName);
        ProvisioningPlan plan = null;
        List assignedRoles = identity.getAssignedRoles();  
        if(!assignedRoles.isEmpty()){
        plan = new ProvisioningPlan();
        plan.setIdentity(identity);
        for(Bundle bundle:assignedRoles){
        AccountRequest accountRequest = new AccountRequest();
        accountRequest.setApplication("IIQ");
        accountRequest.setNativeIdentity(identityName);
        accountRequest.setOp(ProvisioningPlan.ObjectOperation.Modify);
        accountRequest.add(new AttributeRequest("assignedRoles",ProvisioningPlan.Operation.Remove,bundle.getName()));
        plan.add(accountRequest);
         }
        }
       if(plan!=null){
        Provisioner provisioner = new Provisioner(context);
        provisioner.compile(plan);  
        provisioner.execute();
        }
      </Source>
</Rule>